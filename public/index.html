<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>AI Readiness Assessment - Grovia Digital</title>
    <meta name="description" content="Evaluate your company's AI readiness with our comprehensive assessment tool. Get personalized recommendations and a detailed report." />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #root {
        width: 100%;
        max-width: 100%;
      }
      .loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
        color: white;
      }
      .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid rgba(255,255,255,0.3);
        border-top: 4px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body>
    <div id="root">
      <div class="loading">
        <div class="spinner"></div>
        <p>Loading AI Assessment...</p>
      </div>
    </div>
    <script type="module">
      // Latest AI Assessment Application with (Frage 1) numbering
      import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from 'react/jsx-runtime';
      import React, { useState, useRef, useEffect } from 'react';
      import { createRoot } from 'react-dom/client';

      // Assessment Questions with Latest Features
      const assessmentQuestions = [
        {
          id: '1',
          text: {
            de: 'Was ist das Hauptziel Ihres Unternehmens bei der Einführung von KI?',
            en: 'What is your company\'s main goal when introducing AI?'
          },
          type: 'text'
        },
        {
          id: '2', 
          text: {
            de: 'Welche Erfahrungen haben Sie bereits mit KI-Technologien gemacht?',
            en: 'What experience do you already have with AI technologies?'
          },
          type: 'text'
        },
        {
          id: '3',
          text: {
            de: 'Wie würden Sie Ihre aktuelle IT-Infrastruktur bewerten?',
            en: 'How would you rate your current IT infrastructure?'
          },
          type: 'text'
        },
        {
          id: '4',
          text: {
            de: 'Wie sammeln und speichern Sie derzeit Ihre Geschäftsdaten?',
            en: 'How do you currently collect and store your business data?'
          },
          type: 'text'
        },
        {
          id: '5',
          text: {
            de: 'Wie gehen Sie mit Datenschutz und Compliance um?',
            en: 'How do you handle data protection and compliance?'
          },
          type: 'text'
        },
        {
          id: '6',
          text: {
            de: 'Welche Geschäftsprozesse möchten Sie automatisieren?',
            en: 'Which business processes would you like to automate?'
          },
          type: 'text'
        },
        {
          id: '7',
          text: {
            de: 'Wie ist die KI-Kompetenz in Ihrem Team?',
            en: 'What is the AI competency level in your team?'
          },
          type: 'text'
        },
        {
          id: '8',
          text: {
            de: 'Wie unterstützt das Management KI-Initiativen?',
            en: 'How does management support AI initiatives?'
          },
          type: 'text'
        },
        {
          id: '9',
          text: {
            de: 'Welche Risiken sehen Sie bei der KI-Einführung?',
            en: 'What risks do you see in AI implementation?'
          },
          type: 'text'
        },
        {
          id: '10',
          text: {
            de: 'Welchen Zeitrahmen stellen Sie sich für die KI-Implementierung vor?',
            en: 'What timeframe do you envision for AI implementation?'
          },
          type: 'text'
        }
      ];

      // Generate unique session ID
      function generateSessionId() {
        return Math.random().toString(36).substring(2) + Date.now().toString(36);
      }

      // Main Assessment Component with Latest Features
      function AssessmentApp() {
        const [language, setLanguage] = useState('de');
        const [sessionId] = useState(() => generateSessionId());
        const [currentStep, setCurrentStep] = useState('consent');
        const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
        const [messages, setMessages] = useState([]);
        const [consents, setConsents] = useState({
          dataProcessing: false,
          contactPermission: false
        });
        const [contactInfo, setContactInfo] = useState({});
        const [responses, setResponses] = useState({});
        const [waitingForFollowUp, setWaitingForFollowUp] = useState(false);
        const [questionsWithFollowUp, setQuestionsWithFollowUp] = useState(new Set());
        const [isLoading, setIsLoading] = useState(false);
        const messagesEndRef = useRef(null);

        const scrollToBottom = () => {
          messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
        };

        useEffect(() => {
          scrollToBottom();
        }, [messages]);

        useEffect(() => {
          // Initialize welcome messages
          const welcomeMessages = [
            {
              id: '1',
              type: 'bot',
              content: language === 'de' 
                ? 'Hallo! Willkommen zum AI Readiness Assessment. Ich helfe Ihnen dabei, die KI-Bereitschaft Ihres Unternehmens zu bewerten.'
                : 'Hello! Welcome to the AI Readiness Assessment. I will help you evaluate your company\'s AI readiness.',
              timestamp: new Date()
            },
            {
              id: '2',
              type: 'bot',
              content: language === 'de'
                ? 'Das Assessment dauert etwa 5-10 Minuten. Am Ende erhalten Sie einen detaillierten Report per E-Mail.'
                : 'The assessment takes about 5-10 minutes. At the end, you will receive a detailed report via email.',
              timestamp: new Date()
            }
          ];
          setMessages(welcomeMessages);
        }, [language]);

        const addMessage = (type, content) => {
          const newMessage = {
            id: Date.now().toString(),
            type,
            content,
            timestamp: new Date()
          };
          setMessages(prev => [...prev, newMessage]);
        };

        const handleConsentSubmit = (consentData) => {
          setConsents(consentData);
          if (consentData.dataProcessing) {
            addMessage('bot', language === 'de' 
              ? 'Vielen Dank! Bevor wir mit dem Assessment beginnen, benötigen wir einige Kontaktdaten.'
              : 'Thank you! Before we begin the assessment, we need some contact information.');
            setTimeout(() => {
              setCurrentStep('contact-info');
            }, 1000);
          }
        };

        const handleContactInfoSubmit = (contactData) => {
          setContactInfo(contactData);
          addMessage('bot', language === 'de' 
            ? `Vielen Dank, ${contactData.name}! Lassen Sie uns nun mit dem Assessment beginnen.`
            : `Thank you, ${contactData.name}! Let's now begin the assessment.`);
          
          setTimeout(() => {
            setCurrentStep('questions');
            const firstQuestion = assessmentQuestions[0];
            const questionText = firstQuestion.text[language];
            const questionPrefix = language === 'de' ? 'Frage' : 'Question';
            const numberedQuestion = `(${questionPrefix} 1) ${questionText}`;
            addMessage('bot', numberedQuestion);
          }, 1000);
        };

        const handleTextResponse = async (userResponse) => {
          setIsLoading(true);
          addMessage('user', userResponse);

          try {
            const currentQuestion = assessmentQuestions[currentQuestionIndex];
            const questionId = waitingForFollowUp ? `${currentQuestion.id}_followup` : currentQuestion.id;
            const questionText = currentQuestion.text[language];

            const response = await fetch('/api/assessment/analyze', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                sessionId,
                questionId,
                questionText,
                userResponse,
                language
              })
            });

            if (!response.ok) throw new Error('Failed to analyze response');
            
            const data = await response.json();
            const { analysis } = data;

            // Add AI explanation
            if (analysis.explanation) {
              setTimeout(() => {
                addMessage('bot', analysis.explanation);
              }, 500);
            }

            // Store response
            setResponses(prev => ({
              ...prev,
              [questionId]: { userResponse, ...analysis }
            }));

            // Check for follow-up
            if (analysis.needsFollowUp && analysis.followUpQuestion && !questionsWithFollowUp.has(currentQuestion.id)) {
              setTimeout(() => {
                const followUpPrefix = language === 'de' ? 'Nachfrage' : 'Follow-up Question';
                const followUpMessage = `(${followUpPrefix} ${currentQuestionIndex + 1}) ${analysis.followUpQuestion}`;
                addMessage('bot', followUpMessage);
                setWaitingForFollowUp(true);
                setQuestionsWithFollowUp(prev => new Set([...prev, currentQuestion.id]));
              }, 1500);
            } else {
              // Move to next question
              setTimeout(() => {
                proceedToNextQuestion();
              }, 2000);
            }
          } catch (error) {
            console.error('Error:', error);
            addMessage('bot', language === 'de' 
              ? 'Entschuldigung, es gab einen Fehler. Bitte versuchen Sie es erneut.'
              : 'Sorry, there was an error. Please try again.');
          } finally {
            setIsLoading(false);
          }
        };

        const proceedToNextQuestion = () => {
          setWaitingForFollowUp(false);
          
          if (currentQuestionIndex < assessmentQuestions.length - 1) {
            const nextIndex = currentQuestionIndex + 1;
            setCurrentQuestionIndex(nextIndex);
            
            const nextQuestion = assessmentQuestions[nextIndex];
            const questionText = nextQuestion.text[language];
            const questionPrefix = language === 'de' ? 'Frage' : 'Question';
            const numberedQuestion = `(${questionPrefix} ${nextIndex + 1}) ${questionText}`;
            
            setTimeout(() => {
              addMessage('bot', numberedQuestion);
            }, 500);
          } else {
            completeAssessment();
          }
        };

        const completeAssessment = async () => {
          try {
            const response = await fetch('/api/assessment/complete', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ sessionId })
            });
            
            if (response.ok) {
              const data = await response.json();
              setCurrentStep('completed');
              addMessage('bot', language === 'de'
                ? `Vielen Dank! Ihr Assessment ist abgeschlossen. Ihre KI-Readiness beträgt ${data.readinessScore}%. Sie erhalten in Kürze einen detaillierten Report per E-Mail.`
                : `Thank you! Your assessment is complete. Your AI readiness score is ${data.readinessScore}%. You will receive a detailed report via email shortly.`);
            }
          } catch (error) {
            console.error('Error completing assessment:', error);
          }
        };

        return _jsxs("div", {
          style: { maxWidth: '800px', margin: '0 auto', padding: '20px' },
          children: [
            _jsx("div", {
              style: {
                background: 'white',
                borderRadius: '12px',
                padding: '20px',
                minHeight: '600px',
                boxShadow: '0 4px 20px rgba(0,0,0,0.1)'
              },
              children: _jsxs("div", {
                children: [
                  _jsx("h1", {
                    style: { textAlign: 'center', color: '#333', marginBottom: '20px' },
                    children: language === 'de' ? 'AI Readiness Assessment' : 'AI Readiness Assessment'
                  }),
                  _jsx("div", {
                    style: { height: '500px', overflowY: 'auto', marginBottom: '20px' },
                    children: _jsxs("div", {
                      children: [
                        messages.map(message => _jsx("div", {
                          style: {
                            display: 'flex',
                            justifyContent: message.type === 'user' ? 'flex-end' : 'flex-start',
                            marginBottom: '10px'
                          },
                          children: _jsx("div", {
                            style: {
                              maxWidth: '70%',
                              padding: '12px 16px',
                              borderRadius: '18px',
                              backgroundColor: message.type === 'user' ? '#007bff' : '#f1f3f4',
                              color: message.type === 'user' ? 'white' : '#333'
                            },
                            children: message.content
                          })
                        }, message.id)),
                        _jsx("div", { ref: messagesEndRef })
                      ]
                    })
                  }),
                  currentStep === 'consent' && _jsx(ConsentForm, {
                    language: language,
                    onSubmit: handleConsentSubmit
                  }),
                  currentStep === 'contact-info' && _jsx(ContactInfoForm, {
                    language: language,
                    onSubmit: handleContactInfoSubmit
                  }),
                  currentStep === 'questions' && _jsx(TextInput, {
                    language: language,
                    onSubmit: handleTextResponse,
                    disabled: isLoading
                  })
                ]
              })
            }),
            _jsx("div", {
              style: { textAlign: 'center', marginTop: '20px' },
              children: _jsx("button", {
                onClick: () => setLanguage(language === 'de' ? 'en' : 'de'),
                style: {
                  background: 'rgba(255,255,255,0.2)',
                  border: 'none',
                  color: 'white',
                  padding: '8px 16px',
                  borderRadius: '20px',
                  cursor: 'pointer'
                },
                children: language === 'de' ? 'Switch to English' : 'Auf Deutsch wechseln'
              })
            })
          ]
        });
      }

      // Consent Form Component
      function ConsentForm({ language, onSubmit }) {
        const [consents, setConsents] = useState({
          dataProcessing: false,
          contactPermission: false
        });

        const handleSubmit = (e) => {
          e.preventDefault();
          onSubmit(consents);
        };

        return _jsx("form", {
          onSubmit: handleSubmit,
          style: { padding: '20px' },
          children: _jsxs("div", {
            children: [
              _jsx("h3", {
                children: language === 'de' ? 'Einverständniserklärung' : 'Consent Declaration'
              }),
              _jsxs("label", {
                style: { display: 'block', marginBottom: '15px' },
                children: [
                  _jsx("input", {
                    type: "checkbox",
                    checked: consents.dataProcessing,
                    onChange: (e) => setConsents(prev => ({ ...prev, dataProcessing: e.target.checked })),
                    style: { marginRight: '10px' }
                  }),
                  language === 'de' 
                    ? 'Ich stimme der Verarbeitung meiner Daten für das Assessment zu.'
                    : 'I agree to the processing of my data for the assessment.'
                ]
              }),
              _jsxs("label", {
                style: { display: 'block', marginBottom: '15px' },
                children: [
                  _jsx("input", {
                    type: "checkbox",
                    checked: consents.contactPermission,
                    onChange: (e) => setConsents(prev => ({ ...prev, contactPermission: e.target.checked })),
                    style: { marginRight: '10px' }
                  }),
                  language === 'de'
                    ? 'Ich erlaube die Kontaktaufnahme für weitere Informationen.'
                    : 'I allow contact for further information.'
                ]
              }),
              _jsx("button", {
                type: "submit",
                disabled: !consents.dataProcessing,
                style: {
                  background: consents.dataProcessing ? '#007bff' : '#ccc',
                  color: 'white',
                  border: 'none',
                  padding: '12px 24px',
                  borderRadius: '6px',
                  cursor: consents.dataProcessing ? 'pointer' : 'not-allowed'
                },
                children: language === 'de' ? 'Weiter' : 'Continue'
              })
            ]
          })
        });
      }

      // Contact Info Form Component
      function ContactInfoForm({ language, onSubmit }) {
        const [formData, setFormData] = useState({
          name: '',
          email: '',
          companyName: '',
          employeeNumber: ''
        });

        const handleSubmit = (e) => {
          e.preventDefault();
          onSubmit(formData);
        };

        const handleChange = (field, value) => {
          setFormData(prev => ({ ...prev, [field]: value }));
        };

        return _jsx("form", {
          onSubmit: handleSubmit,
          style: { padding: '20px' },
          children: _jsxs("div", {
            children: [
              _jsx("h3", {
                children: language === 'de' ? 'Kontaktinformationen' : 'Contact Information'
              }),
              _jsxs("div", {
                style: { marginBottom: '15px' },
                children: [
                  _jsx("label", {
                    children: language === 'de' ? 'Name *' : 'Name *'
                  }),
                  _jsx("input", {
                    type: "text",
                    required: true,
                    value: formData.name,
                    onChange: (e) => handleChange('name', e.target.value),
                    style: {
                      width: '100%',
                      padding: '8px',
                      marginTop: '5px',
                      border: '1px solid #ddd',
                      borderRadius: '4px'
                    }
                  })
                ]
              }),
              _jsxs("div", {
                style: { marginBottom: '15px' },
                children: [
                  _jsx("label", {
                    children: language === 'de' ? 'E-Mail *' : 'Email *'
                  }),
                  _jsx("input", {
                    type: "email",
                    required: true,
                    value: formData.email,
                    onChange: (e) => handleChange('email', e.target.value),
                    style: {
                      width: '100%',
                      padding: '8px',
                      marginTop: '5px',
                      border: '1px solid #ddd',
                      borderRadius: '4px'
                    }
                  })
                ]
              }),
              _jsxs("div", {
                style: { marginBottom: '15px' },
                children: [
                  _jsx("label", {
                    children: language === 'de' ? 'Unternehmen *' : 'Company *'
                  }),
                  _jsx("input", {
                    type: "text",
                    required: true,
                    value: formData.companyName,
                    onChange: (e) => handleChange('companyName', e.target.value),
                    style: {
                      width: '100%',
                      padding: '8px',
                      marginTop: '5px',
                      border: '1px solid #ddd',
                      borderRadius: '4px'
                    }
                  })
                ]
              }),
              _jsxs("div", {
                style: { marginBottom: '15px' },
                children: [
                  _jsx("label", {
                    children: language === 'de' ? 'Mitarbeiteranzahl' : 'Number of Employees'
                  }),
                  _jsx("select", {
                    value: formData.employeeNumber,
                    onChange: (e) => handleChange('employeeNumber', e.target.value),
                    style: {
                      width: '100%',
                      padding: '8px',
                      marginTop: '5px',
                      border: '1px solid #ddd',
                      borderRadius: '4px'
                    },
                    children: [
                      _jsx("option", { value: "", children: language === 'de' ? 'Bitte wählen' : 'Please select' }),
                      _jsx("option", { value: "1-10", children: "1-10" }),
                      _jsx("option", { value: "11-50", children: "11-50" }),
                      _jsx("option", { value: "51-200", children: "51-200" }),
                      _jsx("option", { value: "201-500", children: "201-500" }),
                      _jsx("option", { value: "500+", children: "500+" })
                    ]
                  })
                ]
              }),
              _jsx("button", {
                type: "submit",
                style: {
                  background: '#007bff',
                  color: 'white',
                  border: 'none',
                  padding: '12px 24px',
                  borderRadius: '6px',
                  cursor: 'pointer'
                },
                children: language === 'de' ? 'Assessment starten' : 'Start Assessment'
              })
            ]
          })
        });
      }

      // Text Input Component
      function TextInput({ language, onSubmit, disabled }) {
        const [value, setValue] = useState('');

        const handleSubmit = (e) => {
          e.preventDefault();
          if (value.trim()) {
            onSubmit(value.trim());
            setValue('');
          }
        };

        return _jsx("form", {
          onSubmit: handleSubmit,
          style: { padding: '20px' },
          children: _jsxs("div", {
            style: { display: 'flex', gap: '10px' },
            children: [
              _jsx("input", {
                type: "text",
                value: value,
                onChange: (e) => setValue(e.target.value),
                placeholder: language === 'de' ? 'Ihre Antwort...' : 'Your answer...',
                disabled: disabled,
                style: {
                  flex: 1,
                  padding: '12px',
                  border: '1px solid #ddd',
                  borderRadius: '6px',
                  fontSize: '16px'
                }
              }),
              _jsx("button", {
                type: "submit",
                disabled: disabled || !value.trim(),
                style: {
                  background: disabled || !value.trim() ? '#ccc' : '#007bff',
                  color: 'white',
                  border: 'none',
                  padding: '12px 24px',
                  borderRadius: '6px',
                  cursor: disabled || !value.trim() ? 'not-allowed' : 'pointer'
                },
                children: disabled ? '...' : (language === 'de' ? 'Senden' : 'Send')
              })
            ]
          })
        });
      }

      // Initialize the app
      const root = createRoot(document.getElementById('root'));
      root.render(_jsx(AssessmentApp));
    </script>
  </body>
</html>
